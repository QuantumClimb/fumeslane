// Prisma schema for FumesLane Perfume Store (Production - PostgreSQL/Neon)

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model ProductCategory {
  id        Int      @id @default(autoincrement())
  name      String
  products  Product[]
}

model Product {
  id                Int              @id @default(autoincrement())
  name              String
  namePt            String?          // Portuguese translation of name
  description       String
  descriptionPt     String?          // Portuguese translation of description
  price             Float
  
  // Perfume-specific fields
  brand             String?
  volume            Float?           // Volume in ml (e.g., 50, 100)
  concentration     String?          // EDP, EDT, Parfum, Cologne, etc.
  gender            String?          // Male, Female, Unisex
  fragranceFamily   String?          // Floral, Oriental, Woody, Fresh, etc.
  topNotes          String?          // Comma-separated top notes
  middleNotes       String?          // Comma-separated middle notes
  baseNotes         String?          // Comma-separated base notes
  
  // Inventory
  stockQuantity     Int              @default(0)
  inStock           Boolean          @default(true)
  
  // Category
  categoryId        Int
  category          ProductCategory  @relation(fields: [categoryId], references: [id])
  
  // Images
  imageUrl          String?          // External image URL
  imageData         String?          // Base64 encoded image data
  imageMimeType     String?          // MIME type (image/jpeg, image/png, etc.)
  imageSize         Int?             // Image size in bytes
  
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
}

model Customer {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  phone     String
  addresses Json     // Array of delivery addresses
  orders    Order[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id                    Int           @id @default(autoincrement())
  orderNumber           String        @unique // e.g., "ORD-20251102-001"
  
  // Customer Information
  customerId            Int?
  customer              Customer?     @relation(fields: [customerId], references: [id])
  customerName          String
  customerEmail         String
  customerPhone         String
  
  // Delivery Information
  deliveryAddress       Json          // {street, apartment, city, postalCode, country}
  deliveryInstructions  String?
  
  // Order Details
  orderItems            Json          // Array of cart items with quantities, customizations
  subtotal              Float
  deliveryFee           Float         @default(0)
  total                 Float
  
  // Status
  status                OrderStatus   @default(PENDING)
  paymentStatus         PaymentStatus @default(PENDING)
  
  // Payment Information
  paymentMethod         PaymentMethod
  razorpayOrderId       String?       @unique  // Razorpay Order ID
  razorpayPaymentId     String?       @unique  // Razorpay Payment ID
  razorpaySignature     String?                // Payment verification signature
  
  // Timestamps
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  confirmedAt           DateTime?
  completedAt           DateTime?
  
  @@index([orderNumber])
  @@index([customerEmail])
  @@index([status])
  @@index([createdAt])
}

enum OrderStatus {
  PENDING       // Order created, payment pending
  CONFIRMED     // Payment received
  PROCESSING    // Order being processed
  SHIPPED       // Package shipped
  DELIVERED     // Successfully delivered
  CANCELLED     // Order cancelled
}

enum PaymentStatus {
  PENDING       // Awaiting payment
  PROCESSING    // Payment being processed
  SUCCEEDED     // Payment successful
  FAILED        // Payment failed
  REFUNDED      // Payment refunded
}

enum PaymentMethod {
  RAZORPAY      // Razorpay payment gateway
  CASH          // Cash on delivery
  BANK_TRANSFER // Bank transfer
}

model StoreStatus {
  id             Int       @id @default(1) // Single row table
  isOpen         Boolean   @default(true)
  closedMessage  String?   // Custom message to display when closed
  reopenTime     DateTime? // Expected reopening time
  updatedAt      DateTime  @updatedAt
  updatedBy      String?   // Admin user who made the change
  
  @@map("store_status")
}
